<div fxLayout="column" fxLayoutAlign="stretch stretch" [ngClass.gt-sm]="'pad_table'">

  <div *ngIf="participants.length == 0" fxLayoutAlign="center center">
    <mat-spinner></mat-spinner>
  </div>

  <div fxLayout fxLayoutAlign="end end" *ngIf="participants.length != 0">
    <mat-form-field>
      <input matInput type="text" (keyup)="doFilter()" placeholder="Filter" [(ngModel)]="filter">
    </mat-form-field>
  </div>


  <table mat-table matSort [dataSource]="dataSource" [hidden]="participants.length == 0" class="mat-elevation-z1">

    <ng-container matColumnDef="first_name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)">
        {{participant.first_name}} {{participant.last_name}}
      </td>
    </ng-container>

    <ng-container matColumnDef="email" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{participant.email}} </td>
    </ng-container>

    <ng-container matColumnDef="phone" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Phone </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{participant.phone}} </td>
    </ng-container>

    <ng-container matColumnDef="entity" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{participant.entity}} </td>
    </ng-container>

    <ng-container matColumnDef="from" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> From </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{participant.from}} </td>
    </ng-container>

    <ng-container matColumnDef="institute" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Institute/Country </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)">
        {{ participant.from == 'local' ? participant.university: participant.country}}
      </td>
    </ng-container>

    <ng-container matColumnDef="year" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Year of Study </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{ participant.year }} </td>
    </ng-container>

    <ng-container matColumnDef="interest">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Fields of Interest </th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)"> {{ participant.interest }} </td>
    </ng-container>

    <ng-container matColumnDef="cv" [fxHide.lt-sm]="true">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let participant">
        <a *ngIf="participant.cv" target="_blank" href="https://firebasestorage.googleapis.com/v0/b/h4tf-portal2.appspot.com/o/{{ participant.cv_filename }}?alt=media">
          <mat-icon class="cv_icon" aria-hidden="false" aria-label="Example home icon">file_present</mat-icon>
        </a>
      </td>
    </ng-container>

    <ng-container matColumnDef="stage">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="text-align: center;"></th>
      <td mat-cell *matCellDef="let participant" (click)="openProfile(participant.email)">
        <span style="width:100%;" class="stage"
              [ngClass]="{
                'contacted': participant.status === 'contacted',
                'rejected': participant.status === 'rejected',
                'applied': participant.status === 'applied',
                'accepted': participant.status === 'accepted',
                'approved': participant.status === 'approved',
                'realized': participant.status === 'realized',
                'finished': participant.status === 'finished',
                'completed': participant.status === 'completed',
                'eld': participant.status === 'ELD convert'
              }">
          {{ participant.status }}
        </span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
    <tr mat-row *matRowDef="let myRowData; columns: getDisplayedColumns()"></tr>

  </table>

</div>
